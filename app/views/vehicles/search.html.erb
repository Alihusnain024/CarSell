
<% if user_signed_in? %>
  <%= render 'shared/navbar' %> 
  <div class="home-container">
  <div>
  <%= form_with(url: search_vehicles_path, method: 'get', id: 'search-form') do |form| %>
    <div class="row2">
      <%= form.select :"query_params[car_model]", [["Select Car Model", ""], ["suzuki", "suzuki"], ["toyota", "toyota"], ["honda", "honda"], ["bmw", "bmw"]] %>
      <%= form.select :"query_params[city]", [["All Cities", ""], ["rawalpindi", "rawalpindi"], ["lahore", "lahore"], ["karachi", "karachi"], ["peshawar","peshawar"], ["islamabad","islamabad"]] %>
      <%= form.select :"query_params[price]", [["Price range", ""], ["1000000", "price1"], ["2000000", "price2"], ["3000000", "price3"]] %>
    </div>
    <div id="filterRows">
    <div class="row2">
      <%= form.select :"query_params[engine_type]", [["Engine Details", ""], ["petrol", "petrol"], ["diesel", "diesel"], ["hybrid", "hybrid"]] %>
      <%= form.select :"query_params[transmisson_type]", [["Transmission Type", ""], ["manual", "manual"], ["automatic", "automatic"]] %>
      <%= form.select :"query_params[color]", [["Color", ""], ["black", "black"], ["white", "white"], ["gray", "gray"], ["silver", "silver"], ["red","red"]] %>
    </div>
    <div class="row2">
      <%= form.select :"query_params[mileage]", [["Mileage", ""], ["10", "mileage1"], ["15", "mileage2"], ["20", "mileage3"]] %>
      <%= form.select :"query_params[engine_capacity]", [["Engine Capacity", ""], ["1.0L", "e1"], ["2.0L", "e2"], ["3.0L", "e3"]] %>
      <%= form.select :"query_params[assembly_type]", [["Assembly Type", ""], ["local", "local"], ["imported", "imported"]] %>
    </div>
    </div>
    <button type="button" id="showMoreBtn" class="btn btn-secondary m-1">Show More</button>
    <div class='d-flex justify-content-end'>
      <%= form.submit 'Search', class: 'btn btn-primary m-1' %>
<button type="button" class="btn btn-secondary m-1 btn-clear-filters">Clear Filters</button>
    </div>
  <% end %>
</div>

<% @results.each do |vehicle| %>
  <div class="list-container">
  <div class="card">
  <div class="card-body" style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
  <% if vehicle.vehicle_image.attached? %>
    <%= image_tag vehicle.vehicle_image.first, size: '100x100' %>
    <% else %>
    <img src="<%= vehicle.vehicle_image %>" class="card-img" alt="Vehicle Image" style="width: 100px; height: 100px; margin-right: 10px;">
    <% end %>     <div>
      <h5 class="card-title"><%= vehicle.carModel %></h5>
      <p class="card-text"><%= vehicle.price %> PKR</p>
      <%= link_to "Show Details", vehicle_path(vehicle), class: "btn btn-primary" %>
      <% if current_user %>
        <% if current_user.favorites.exists?(vehicle_id: vehicle.id) %>
          <%= link_to "UnFavorite", remove_from_favorites_favourite_path(id: vehicle.id), class: "btn btn-danger", method: :delete %>
        <% else %>
          <%= link_to "Favorite", add_to_favorites_favourite_path(id: vehicle.id), class: "btn btn-success", method: :post %>
        <% end %>
      <% end %>
      
      </div>
  </div>
</div>


</div>

<% end %>


<div class="pagy_nav_bootstrap" style="margin-left: 200px; margin-top:30px; margin-bottom:30px;"><%== pagy_bootstrap_nav(@pagy).html_safe %></div>

<% else %>
  <p>Please <%= link_to "Sign up", new_user_registration_path, :class => 'navbar-link' %> or <%=link_to "Login", new_user_session_path, :class => 'navbar-link' %></p>
<% end %>


<script>
document.addEventListener("turbolinks:load", function () {
  const filterRows = document.getElementById("filterRows");
  const showMoreBtn = document.getElementById("showMoreBtn");
  const searchForm = document.querySelector('form[action="/search"]');
  const homeContainer = document.querySelector(".home-container");

  let isExpanded = true;

  const toggleFormRows = () => {
    if (isExpanded || (searchForm && searchForm.submitted)) {
      filterRows.style.display = "block";
      showMoreBtn.innerText = "Show Less";
      homeContainer.style.height = "400px";
    } else {
      filterRows.style.display = "none";
      showMoreBtn.innerText = "Show More";
      homeContainer.style.height = "250px";
    }
  };

  toggleFormRows();

  showMoreBtn.addEventListener("click", function () {
    if (!searchForm || !searchForm.submitted) {
      isExpanded = !isExpanded;
    }

    toggleFormRows();
  });

  if (searchForm) {
    searchForm.addEventListener("submit", function () {
      searchForm.submitted = true;

      toggleFormRows();
    });
  }
});
</script>